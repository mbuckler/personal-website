<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="cornellcsl">
  <meta name="generator" content="Hugo 0.40.1" />
  <meta name="author" content="Mark Buckler">
  <meta name="description" content="AI Researcher &amp; Entrepreneur">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/academicons.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7cMerriweather%7cRoboto&#43;Mono">
  <link rel="stylesheet" href="/css/cornellcsl.min.css">
  

  <link rel="alternate" href="http://markbuckler.com/index.xml" type="application/rss+xml" title="Mark Buckler">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="http://markbuckler.com/post/docker-use/">

  

  <title>Developing in Docker | Mark Buckler</title>

  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
  <script async src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
  <script defer>
  window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#ffffff",
        "text": "#000000"
      },
      "button": {
        "background": "#b31b1b",
        "text": "#ffffff"
      }
    },
    "showLink": false,
    "content": {
      "message": "This website uses cookies for analytics and to enable comments.",
      "dismiss": "Cool! I get it."
    }
  })});
  </script>
</head>
<body data-spy="scroll" data-target="#navbar-main" data-offset="71">

    
    <a class="sr-only" href="#content">Skip to main content</a>
    <header id="top" class="cu-banner">
    
    
    </header>


<div class="nav-wrapper">
<nav class="navbar navbar-default" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Mark Buckler</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#patents">
            
            <span>Patents</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>Talks</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        
      </ul>

    </div>
  </div>
</nav>
</div>


<article class="article" itemscope itemtype="http://schema.org/BlogPosting">

  

  <div class="article-container">
    <h1 itemprop="name headline">Developing in Docker</h1>
    

<div class="article-metadata">

  
  <span class="article-date">
    <time datetime="2017-04-02T16:25:31-04:00" itemprop="datePublished">
      Sun, Apr 2, 2017
    </time>
  </span>

  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fmarkbuckler.com%2fpost%2fdocker-use%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Developing%20in%20Docker&amp;url=http%3a%2f%2fmarkbuckler.com%2fpost%2fdocker-use%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fmarkbuckler.com%2fpost%2fdocker-use%2f&amp;title=Developing%20in%20Docker"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fmarkbuckler.com%2fpost%2fdocker-use%2f&amp;title=Developing%20in%20Docker"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Developing%20in%20Docker&amp;body=http%3a%2f%2fmarkbuckler.com%2fpost%2fdocker-use%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      <p>Most of us academic/industrial ECE/CS researchers want to make our
results as reproducible as possible. Its good for the integrity of our
field and it also helps future researchers and developers to build on
our prior work. <a href="https://github.com/" target="_blank">GitHub</a> is great for distributing
software, but code can rarely be compiled and run on its own as nearly
all modern software relies heavily on packages and dependencies.
Installing these dependencies can be incredibly frustrating or possibly
even impossible depending on how long ago the code was written.
Thankfully, <a href="https://www.docker.com/" target="_blank">Docker</a> is here to save the day!</p>

<ul>
<li><p>What benefits does Docker provide?</p>

<p>Running code or even product deployment without ever installing
dependencies, enabling multiple dependency versions on a server without
conflicts, &ldquo;pulling&rdquo; of environments from <a href="https://hub.docker.com/" target="_blank">Docker
Hub</a> as simply and easily as cloning a GitHub
repository, and all without noticeable performance degradation.</p></li>

<li><p>How does Docker provide all of this modularity and portability?</p>

<p>By very nearly being a Virtual Machine (VM) but not going the full way.
<a href="https://docs.docker.com/get-started/#containers-vs-virtual-machines" target="_blank">See here for more
details</a>,
but rather than implementing an entire OS as a VM might do, an
instantiation of a Docker image (called a &ldquo;Container&rdquo;) only implements
binaries, libraries, and applications. This makes running a Windows
image on Linux or vice versa tricky since they don&rsquo;t have the same
kernel, but since most of the folks I know develop on Linux this hasn&rsquo;t
been a problem for me. In case you&rsquo;re interested in running Docker on
macOS or Windows check out <a href="http://containerjournal.com/2016/08/15/docker-not-just-linux-anymore/" target="_blank">this blog
post</a>.</p></li>

<li><p>From a practical standpoint, how do I use Docker?</p>

<p><img src="/img/docker_high_level.png" alt="Docker at a high level" /></p>

<p>First, write an installation script for all of your dependencies. This
script is written with Docker specific syntax and is called a
Dockerfile. Then, run these commands to build a Docker image of your
environment by using <code>docker build</code>. Once successfully built, you can
instantiate copies of this image as many times as you would like by
using <code>docker run</code> to create Docker containers. It is in these
containers that you will run or develop your code. If you would like
other people to be able to use your Docker image you can push to
DockerHub (with <code>docker push</code>), and if you want to use someone else&rsquo;s
image you can pull from DockerHub (with <code>docker pull</code>).</p></li>

<li><p>How do I write a Dockerfile?</p>

<p>You can check out the <a href="https://docs.docker.com/engine/reference/builder/" target="_blank">full reference</a>, but here is
a simple example:</p>

<pre><code># Start with an existing Docker image to give yourself a head start
FROM ubuntu:14.04

# Change to a given directory
WORKDIR /root

# Run some shell commands to install dependencies
RUN apt-get update &amp;&amp; apt-get upgrade &amp;&amp; apt-get install -y \
    build-essential \
    git \
    etc...

# Clone and build code not available through your package manager
RUN git clone https://github.com/halide/Halide.git
WORKDIR /root/Halide
RUN make -j8

# Set any necessary environment variables
ENV LD_LIBRARY_PATH /root/Halide/bin:$LD_LIBRARY_PATH

# Lastly, set your workdir to be your default when starting the image
WORKDIR /root
</code></pre></li>

<li><p>How do I run a Docker image (create a docker container)?</p>

<p>First, pull the image you&rsquo;d like to use or build one from a Dockerfile
like the one shown above.</p>

<pre><code>docker pull mbuckler/approx-vision
</code></pre>

<p>Then, use the docker run command.</p>

<pre><code>docker run \
-v &lt;path to datasets&gt;:/datasets \
-v &lt;path to approx-vision&gt;:/approx-vision \
-it mbuckler/approx-vision \
/bin/bash
</code></pre>

<p>In the example command above you see that I start with <code>docker run</code>, and
then create two <a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank">docker
volumes</a>. These
volumes allow me to interact with data outside of the docker container.
Then I choose which image to run, and start myself off with a bash
shell.</p></li>

<li><p>What if I want to use my GPU from within a Docker container?</p>

<p>You&rsquo;re in luck! NVIDIA provides
<a href="https://github.com/NVIDIA/nvidia-docker" target="_blank">nvidia-docker</a>, a specific
application for linking NVIDIA GPU&rsquo;s and docker.</p></li>

<li><p>What if I want to use X forwarding from within a Docker container?</p>

<p><a href="https://people.ece.cornell.edu/skand/" target="_blank">Skand Hurkat</a> and I figured
out a great way to do this. He&rsquo;s posted the instructions
<a href="https://people.ece.cornell.edu/skand/post/x-forwarding-on-docker/" target="_blank">here</a>,
but I&rsquo;ll cross-post them here for completeness.</p>

<ol>
<li><p>Include the X packages within your Docker image by adding these
commands to your Dockerfile.</p>

<pre><code>RUN apt-get update
RUN apt-get install -qqy x11-apps
</code></pre></li>

<li><p>Set the path to your <code>.Xauthority</code> file. Your <code>.Xauthority</code> file
will automatically be created in your home directory if using X11
forwarding on a server you&rsquo;re accessing remotely, but if you&rsquo;re using
Docker on your local device then you&rsquo;ll need to create the file with
touch.</p>

<pre><code>XAUTH=$HOME/.Xauthority
touch $XAUTH
</code></pre></li>

<li><p>Run your Docker image. Use the host&rsquo;s networking stack and
connect both the display and Xauthority environment variables.</p>

<pre><code>docker run --network=host --env DISPLAY=$DISPLAY -v $XAUTH:/root/.Xauthority -it &lt;dockerimagename&gt; 
</code></pre></li>
</ol></li>

<li><p>OK Docker fanboy, tell me the downsides&hellip;</p>

<p>For one, creating/pulling lots of Docker images can take up a lot of
disk space. The real downside however is that Docker users have sudo
privileges on the local machine when running containers. You can find a
really excellent blog post about this
<a href="https://fosterelli.co/privilege-escalation-via-docker.html" target="_blank">here</a>, but
at the end of the day you have two choices:</p>

<ol>
<li><p>Require that users invoke sudo when executing docker commands.</p>

<p>This isn&rsquo;t super attractive since it makes usage less convenient,
but it is the safest option.</p></li>

<li><p>Create and use a docker group.</p>

<p>With this option anyone who is in the docker group can run docker
commands without sudo. This is the option I use, where I only add users to the docker
group that I would consider adding to the sudo group. I also inform new
users about the dangers, as you can do a lot of damage by mounting
sensitive volumes.</p></li>
</ol></li>
</ul>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="http://markbuckler.com/post/install-cuda/"><span
      aria-hidden="true">&larr;</span> How to Install NVIDIA GPU Drivers &amp; CUDA</a></li>
    

    
    <li class="next"><a href="http://markbuckler.com/post/latex-in-vim/">Writing LaTeX in Vim <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "markbuckler" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>



    <script defer src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
    <script defer src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/ScrollToPlugin.min.js"></script>
    <script defer src="/js/jquery-1.12.3.min.js"></script>
    <script defer src="/js/jquery.easing.min.js"></script>
    <script defer src="/js/bootstrap.min.js"></script>
    <script defer src="/js/isotope.pkgd.min.js"></script>
    <script defer src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.1/imagesloaded.pkgd.min.js"></script>
    <script defer src="/js/cornellcsl.min.js"></script>
    

    
    <script defer>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-98211041-1', 'auto');
        ga('send', 'pageview');

         
        var links = document.querySelectorAll('a');
        Array.prototype.map.call(links, function(item) {
            if (item.host != document.location.host) {
                item.addEventListener('click', function() {
                    var action = item.getAttribute('data-action') || 'follow';
                    ga('send', 'event', 'outbound', action, item.href);
                });
            }
        });
    </script>
    

    
    
      
      <script defer src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

